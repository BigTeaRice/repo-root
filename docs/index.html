<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>å³æ™‚è¡Œæƒ…</title>
<script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
<style>
body{margin:0;font-family:-apple-system,BlinkMacSystemFont;background:#f4f6fa;color:#333}
.container{max-width:900px;margin:20px auto}
.card{background:#fff;border-radius:12px;padding:15px;margin:10px 0;box-shadow:0 2px 8px rgba(0,0,0,.15)}
h1{text-align:center}
#chart{height:420px}
</style>
</head>
<body>
<div class="container">
  <h1>ğŸ“ˆ å³æ™‚è¡Œæƒ… (GitHub Pages)</h1>
  <div class="card">
    <select id="sel"></select>
    <button onclick="loadData()">è¼‰å…¥</button>
    <div id="info"></div>
    <div id="chart"></div>
  </div>
</div>

<script>
const $ = q => document.querySelector(q);
const sel = $('#sel'), info = $('#info'), myChart = echarts.init($('#chart'));

// â‘  åˆ—å‡ºæ‰€æœ‰ JSON
fetch('data/meta.json').then(r => r.json()).then(m => {
  sel.innerHTML = m.stocks.map(s => `<option value="${s}">${s}</option>`).join('');
  loadData();
}).catch(() => sel.innerHTML = '<option>AAPL</option>');

// â‘¡ è¼‰å…¥é¸å®šè‚¡ç¥¨
async function loadData() {
  const sym = sel.value;
  const json = await fetch(`data/${sym.toLowerCase().replace('.','_')}.json?t=${Date.now()}`).then(r => r.json());
  const df = json.data, last = df[df.length - 1];
  info.innerHTML = `
    <div>æœ€æ–°åƒ¹: <b>${last.close.toFixed(2)}</b></div>
    <div>æ›´æ–°: ${new Date(json.updated).toLocaleString()}</div>
  `;
  // â‘¢ ç°¡æ˜“èµ°å‹¢
  const times = df.map(it => it.datetime.slice(11, 16));
  const prices = df.map(it => it.close);
  myChart.setOption({
    title: { text: sym, left: 'center' },
    tooltip: { trigger: 'axis' },
    xAxis: { type: 'category', data: times },
    yAxis: { type: 'value', scale: true },
    series: [{ type: 'line', data: prices, smooth: true, lineStyle: { width: 2, color: '#2962ff' }, areaStyle: { opacity: 0.2 } }]
  });
}
</script>
</body>
</html>
