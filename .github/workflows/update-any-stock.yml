name: 更新任意股票日线（手动输入）

on:
  workflow_dispatch:
    inputs:
      symbols:
        description: "股票代码（美股/港股），多个用英文逗号分隔，如 AAPL,0700.HK,TSLA"
        required: true
        default: "AAPL,0700.HK"
      period:
        description: "周期"
        required: true
        default: "30d"
        type: choice
        options: ["1d","5d","30d","90d","180d","1y"]

jobs:
  crawl:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install deps
        run: pip install -U yfinance

      - name: 清理旧 JSON
        run: rm -rf docs/data

      - name: 生成 JSON
        run: |
          python $GITHUB_WORKSPACE/crawl.py \
            "${{ github.event.inputs.symbols }}" \
            "${{ github.event.inputs.period }}"

      - name: Commit & Push
        run: |
          git config user.name 'github-actions[bot]'
          git config user.email 'github-actions[bot]@users.noreply.github.com'
          git add docs/data
          git diff --cached --quiet && echo "无更新" || (
            git commit -m "chore: 更新 ${{ github.event.inputs.symbols }} ${{ github.event.inputs.period }} 数据"
            git push
          )
