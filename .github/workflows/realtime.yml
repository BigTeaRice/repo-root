name: Real-Time Data â†’ GitHub Pages

# è§¸ç™¼æ™‚æ©Ÿ
on:
  schedule:
    - cron: '*/15 * * * *'   # æ¯ 15 åˆ†é˜åŸ·è¡Œ
  workflow_dispatch:         # æ‰‹å‹•è§¸ç™¼æŒ‰éˆ•
  push:
    branches: [main]         # æ¨é€ç«‹åˆ»è·‘ä¸€æ¬¡

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      # 1. æª¢å‡ºåŸå§‹ç¢¼
      - name: Checkout
        uses: actions/checkout@v3

      # 2. è¨­å®š Python
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      # 3. å®‰è£å¥—ä»¶
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 4. å»ºç«‹/æ¸…ç†è¼¸å‡ºç›®éŒ„ï¼ˆbash å±¤ç´šä¿è­‰è³‡æ–™å¤¾å­˜åœ¨ï¼‰
      - name: Create & Clean output folder
        run: |
          mkdir -p docs/data
          rm -f docs/data/*.json
          echo "ğŸ“‚ docs/data å·²å‚™å¦¥"

      # 5. ç”¢ç”Ÿæœ€æ–° JSONï¼ˆæœƒå¯«å…¥ docs/data/*.jsonï¼‰
      - name: Generate latest JSON
        run: python update_realtime_json.py

      # 6. éƒ¨ç½²åˆ° GitHub Pagesï¼ˆgh-pages åˆ†æ”¯ï¼‰
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          # è‹¥é–‹å•Ÿ Settings â†’ Actions â†’ Read and write å³å¯ç”¨ GITHUB_TOKEN
          github_token: ${{ secrets.GITHUB_TOKEN }}
          # è‹¥æƒ³ç”¨ PAT å¯æ”¹æˆ personal_token: ${{ secrets.PAT_TOKEN }}
          publish_dir: ./docs
          publish_branch: gh-pages
          force_orphan: true        # è®“ gh-pages æ­·å²ä¿æŒå–®æ”¯ commitï¼ˆå¯çœç•¥ï¼‰
